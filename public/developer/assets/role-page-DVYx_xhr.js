import{V as y,_ as R,I as m,y as P,Y as i,v as d,g as c,F as x,o,d as h,q as v,R as k,w as A,l as I,r as E,h as p,M as S,i as C,e as g,H as D,D as a,p as M,f as n}from"./index-DM3KSgk2.js";import{S as q}from"./sidebar-menu-page-D_2zNFuZ-DKHVgHxo.js";import{R as w}from"./role-model-UgqUCBfV.js";import{P as H}from"./permission-model-D50hiXxS.js";const T=y.extend({url:"/api/user/role/[[roleId]]/permission/[[permissionId]]",xhr:{}}),z=(e,s,t)=>{const l=new T({roleId:s,permissionId:t}),r=e?"add":"delete";l.xhr[r]("",u=>{(!u||u.success===!1)&&app.notify({type:"destructive",title:"Error",description:`An error occurred while ${r==="add"?"adding":"removing"} the permission.`,icon:o.shield})})},F=()=>i({class:"flex flex-col space-y-8"},[...[1,2,3,4].map(()=>i({class:"flex flex-col space-y-2"},[i({class:"flex items-center space-x-2"},[d({shape:"circle",width:"w-5",height:"h-5"}),d({width:"w-32",height:"h-4"})]),d({width:"w-40",height:"h-3"})]))]),N=({hasPermission:e,togglePermission:s})=>i({class:"flex flex-col space-y-2",for:["rows",t=>new c({name:t.name,description:t.description},[new x({label:t.name,required:!1,checked:e(t.name),onChange:(l,r)=>{s(t,l)}})])]}),$=R({setData(){return new H({rows:[]})},state:{loaded:!1},fetch(){this.data.xhr.all("",e=>{this.state.loaded=!0,!(!e||e.success===!1)&&(this.data.rows=e.rows)})},hasPermission(e){var t;return(((t=this==null?void 0:this.role)==null?void 0:t.permissions)||[]).find(l=>l.name===e)!==void 0},togglePermission(e,s){const t="permissions",l=this.role.getIndex(t,"id",e.id);s&&l===-1?this.role.push(t,e):!s&&l!==-1&&this.role.splice(t,l),z(s,this.role.id,e.id)},render(){return this.fetch(),m({legend:"Role Permissions"},[P("loaded",e=>e?N({hasPermission:this.hasPermission.bind(this),togglePermission:this.togglePermission.bind(this)}):F())])}}),G=({isEditing:e,role:s})=>[m({legend:"Role Settings"},[new c({name:"name",label:"Role Name",description:"Enter the name of the role."},[h({type:"text",placeholder:"e.g. Admin",required:!0,bind:"name"})]),new c({name:"slug",label:"Slug",description:"URL-friendly version of the role name."},[h({type:"text",placeholder:"e.g. admin",required:!0,bind:"slug"})]),new c({name:"description",label:"Description",description:"A brief description of the role."},[v({placeholder:"A short description...",rows:3,bind:"description"})]),new c({name:"resource",label:"Resource",description:"Defines the scope of the role."},[k({bind:"resource",options:[{value:"global",label:"Global"},{value:"organization",label:"Organization"},{value:"group",label:"Group"},{value:"team",label:"Team"}]})])]),e&&new $({role:s})],L=e=>{e.xhr.add("",s=>{if(!s||s.success===!1){app.notify({type:"destructive",title:"Error",description:"An error occurred while adding the role.",icon:o.shield});return}app.notify({type:"success",title:"Role Added",description:"The role has been added.",icon:o.check})})},O=e=>{e.xhr.update("",s=>{if(!s||s.success===!1){app.notify({type:"destructive",title:"Error",description:"An error occurred while updating the role.",icon:o.shield});return}app.notify({type:"success",title:"Role Updated",description:"The role has been updated.",icon:o.check})})},b=(e={})=>{const s=e.item||{},t=s.id?"edit":"add",l=new w(s);return new A({data:l,title:t==="edit"?"Edit Role":"Add Role",icon:t==="edit"?o.pencil.square:o.document.add,description:t==="edit"?`Editing the '${s.name}' role`:"Let's add a new role.",size:"md",type:"right",onClose:()=>e.onClose&&e.onClose(l),onSubmit:({data:r})=>{t==="edit"?O(r):L(r)}},[i({class:"flex flex-col lg:p-4 space-y-8"},[i({class:"flex flex-auto flex-col w-full gap-4"},G({isEditing:t==="edit",role:l}))])]).open()},U=(e,{list:s})=>{s.refresh()},f=(e,s)=>b({item:e,onClose:t=>s.list.refresh()}),Y=()=>I({class:"flex flex-auto flex-col"},[i({class:"flex flex-auto items-center justify-between w-full"},[E({class:"text-3xl font-bold"},"Roles"),i({class:"flex items-center gap-2"},[i({class:"hidden lg:flex"},[p({variant:"withIcon",class:"text-muted-foreground outline",icon:o.refresh,click:U},"Refresh")]),i({class:"hidden lg:flex"},[p({variant:"withIcon",class:"text-muted-foreground primary",icon:o.circlePlus,click:(e,s)=>f(null,s)},"Add Role")]),i({class:"flex lg:hidden mr-0"},[S({content:"Add Role",position:"left"},p({variant:"icon",class:"outline",icon:o.circlePlus,click:(e,s)=>f(null,s)}))])])])]),_=(e,{parent:s})=>b({item:e,onClose:t=>s.list.mingle([t.get()])}),j=(e,s)=>g({class:"items-center px-4 py-2 hover:bg-muted/50 cursor-pointer",click:(t,l)=>_(e,l)},[a({class:"p-4 hidden md:table-cell"},[new x({checked:e.selected,class:"mr-2",onChange:()=>s(e)})]),a({class:"p-4"},String(e.id)),a({class:"p-4 truncate max-w-[150px]"},e.name),a({class:"p-4 truncate max-w-[150px]"},e.slug),a({class:"p-4 truncate max-w-[200px]"},e.description),a({class:"p-4 truncate max-w-[200px] capitalize"},e.resource),a({class:"p-4 hidden md:table-cell"},e.createdAt)]),K=()=>D([g({class:"text-muted-foreground border-b"},[M({class:"hidden md:table-cell"}),n({key:"id",label:"ID"}),n({key:"name",label:"Name"}),n({key:"slug",label:"Slug"}),n({key:"description",label:"Description"}),n({key:"resource",label:"Resource"}),n({key:"createdAt",label:"Created At",class:"hidden md:table-cell"})])]),V=e=>C({data:e,cache:"list",customHeader:K(),rows:[],limit:50,rowItem:j,key:"id"}),X=()=>{const e=new w({filter:{}}),s={data:e,class:"pt-0",update(){this.list&&this.list.refresh()}};return new q(s,[i({class:"grid grid-cols-1"},[i({class:"flex flex-auto flex-col p-6 pt-0 space-y-6 md:space-y-12 md:pt-6 lg:p-8 w-full mx-auto"},[Y(),i({class:"flex flex-auto flex-col space-y-2 md:space-y-4"},[i({class:"flex flex-col overflow-x-auto"},[V(e)])])])])])};export{X as RolePage,X as default};
